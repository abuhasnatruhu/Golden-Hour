<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golden Hour Interactive Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .warning { color: orange; font-weight: bold; }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover { background: #45a049; }
        iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #333;
            margin-top: 20px;
        }
        .log {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>Golden Hour Application - Interactive Test Suite</h1>
    
    <div class="test-section">
        <h2>1. Page Load Test</h2>
        <button onclick="testPageLoad()">Test Page Load</button>
        <div id="page-load-result"></div>
    </div>

    <div class="test-section">
        <h2>2. API Endpoints Test</h2>
        <button onclick="testAPIs()">Test All APIs</button>
        <div id="api-result"></div>
    </div>

    <div class="test-section">
        <h2>3. Interactive Elements Test</h2>
        <button onclick="testInteractive()">Test Interactive Features</button>
        <div id="interactive-result"></div>
    </div>

    <div class="test-section">
        <h2>4. Console Errors Monitor</h2>
        <button onclick="checkConsoleErrors()">Check Console Errors</button>
        <div id="console-result" class="log"></div>
    </div>

    <div class="test-section">
        <h2>5. Live Application</h2>
        <p>Below is the actual application running in an iframe. Test the following:</p>
        <ul>
            <li>Location search input - Type a city name</li>
            <li>Date picker - Select a date</li>
            <li>Calculate button - Click to get golden hour times</li>
            <li>Auto-detect location button</li>
            <li>Map interactions</li>
            <li>Calendar navigation</li>
        </ul>
        <iframe id="app-frame" src="http://localhost:3002"></iframe>
    </div>

    <script>
        const BASE_URL = 'http://localhost:3002';
        
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : '';
            element.innerHTML += `<div class="${className}">${message}</div>`;
        }

        async function testPageLoad() {
            const resultDiv = document.getElementById('page-load-result');
            resultDiv.innerHTML = '';
            
            try {
                const response = await fetch(BASE_URL);
                const html = await response.text();
                
                // Check for critical elements
                const checks = [
                    { test: html.includes('Golden Hour Calculator'), name: 'Title present' },
                    { test: html.includes('_next/static'), name: 'Next.js assets loading' },
                    { test: html.includes('</script>'), name: 'JavaScript included' },
                    { test: response.status === 200, name: 'Page loads successfully' },
                ];
                
                checks.forEach(check => {
                    log('page-load-result', `${check.name}: ${check.test ? '✓' : '✗'}`, check.test ? 'success' : 'error');
                });
            } catch (error) {
                log('page-load-result', `Error: ${error.message}`, 'error');
            }
        }

        async function testAPIs() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.innerHTML = '';
            
            const apis = [
                { url: '/api/location', name: 'Location API' },
                { url: '/api/weather?lat=40.7128&lon=-74.006', name: 'Weather API' },
                { url: '/api/golden-hour?lat=40.7128&lon=-74.006', name: 'Golden Hour API' },
                { url: '/api/places/search?query=Paris', name: 'Places Search API' },
                { url: '/api/places/nearby?lat=40.7128&lon=-74.006', name: 'Nearby Places API' },
            ];
            
            for (const api of apis) {
                try {
                    const response = await fetch(BASE_URL + api.url);
                    const data = await response.json();
                    log('api-result', `${api.name}: ${response.status === 200 ? '✓' : '✗'} (${response.status})`, response.status === 200 ? 'success' : 'error');
                } catch (error) {
                    log('api-result', `${api.name}: ✗ (${error.message})`, 'error');
                }
            }
        }

        async function testInteractive() {
            const resultDiv = document.getElementById('interactive-result');
            resultDiv.innerHTML = '<p>Testing interactive elements in iframe...</p>';
            
            const iframe = document.getElementById('app-frame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            
            setTimeout(() => {
                try {
                    // Check for interactive elements
                    const inputs = iframeDoc.querySelectorAll('input');
                    const buttons = iframeDoc.querySelectorAll('button');
                    const selects = iframeDoc.querySelectorAll('select');
                    
                    resultDiv.innerHTML = '';
                    log('interactive-result', `Input fields found: ${inputs.length}`, inputs.length > 0 ? 'success' : 'error');
                    log('interactive-result', `Buttons found: ${buttons.length}`, buttons.length > 0 ? 'success' : 'error');
                    log('interactive-result', `Select dropdowns found: ${selects.length}`, 'info');
                    
                    // Test if React is loaded
                    const hasReact = iframe.contentWindow.React !== undefined;
                    log('interactive-result', `React loaded: ${hasReact ? '✓' : '✗'}`, hasReact ? 'success' : 'error');
                    
                    // Check for specific components
                    const locationInput = iframeDoc.querySelector('input[placeholder*="location" i], input[placeholder*="city" i]');
                    const dateInput = iframeDoc.querySelector('input[type="date"], input[placeholder*="date" i]');
                    const calculateButton = iframeDoc.querySelector('button');
                    
                    log('interactive-result', `Location input: ${locationInput ? '✓' : '✗'}`, locationInput ? 'success' : 'error');
                    log('interactive-result', `Date input: ${dateInput ? '✓' : '✗'}`, dateInput ? 'success' : 'error');
                    log('interactive-result', `Calculate button: ${calculateButton ? '✓' : '✗'}`, calculateButton ? 'success' : 'error');
                    
                } catch (error) {
                    log('interactive-result', `Error accessing iframe: ${error.message}`, 'error');
                    log('interactive-result', 'Note: If CORS error, elements are likely working but protected', 'warning');
                }
            }, 3000); // Wait for iframe to load
        }

        function checkConsoleErrors() {
            const resultDiv = document.getElementById('console-result');
            resultDiv.innerHTML = '<p>Open browser console to see errors. Monitoring iframe console...</p>';
            
            // Try to access iframe console
            const iframe = document.getElementById('app-frame');
            try {
                // This might fail due to CORS, but worth trying
                const iframeWindow = iframe.contentWindow;
                
                // Override console methods in iframe
                const originalError = iframeWindow.console.error;
                iframeWindow.console.error = function(...args) {
                    log('console-result', `Error: ${args.join(' ')}`, 'error');
                    originalError.apply(this, args);
                };
                
                log('console-result', 'Console monitoring active', 'success');
            } catch (error) {
                log('console-result', 'Cannot access iframe console due to CORS', 'warning');
                log('console-result', 'Open browser DevTools to see console errors', 'info');
            }
        }

        // Auto-refresh iframe
        setInterval(() => {
            const iframe = document.getElementById('app-frame');
            if (document.querySelector('#auto-refresh:checked')) {
                iframe.src = iframe.src;
            }
        }, 30000);
    </script>

    <div style="margin-top: 20px;">
        <label>
            <input type="checkbox" id="auto-refresh"> Auto-refresh iframe every 30 seconds
        </label>
    </div>
</body>
</html>